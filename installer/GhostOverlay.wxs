<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <!-- Product ID should change for each version, UpgradeCode should stay the same -->
  <Product Id="*"
           Name="GhostOverlay"
           Language="1033"
           Version="1.0.0.0"
           Manufacturer="GhostOverlay Team"
           UpgradeCode="A1B2C3D4-E5F6-47A8-B9C0-D1E2F3A4B5C6">

    <Package InstallerVersion="200"
             Compressed="yes"
             InstallScope="perMachine"
             Description="GhostOverlay - Real-time Server Monitor"
             Comments="Transparent overlay for monitoring HTTP/HTTPS, Ping, and TCP endpoints" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <!-- Application Icon -->
    <Icon Id="GhostOverlay.exe" SourceFile="..\publish\GhostOverlay.exe" />
    <Property Id="ARPPRODUCTICON" Value="GhostOverlay.exe" />

    <!-- Add/Remove Programs properties -->
    <Property Id="ARPHELPLINK" Value="https://github.com/ghostoverlay/ghostoverlay" />
    <Property Id="ARPURLINFOABOUT" Value="https://github.com/ghostoverlay/ghostoverlay" />

    <!-- Feature: Main application -->
    <Feature Id="ProductFeature" Title="GhostOverlay" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="DesktopShortcut" />
    </Feature>

    <!-- UI -->
    <UIRef Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <!-- Custom license -->
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
  </Product>

  <!-- Directory structure -->
  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="GhostOverlay" />
      </Directory>

      <!-- Start Menu -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="GhostOverlay"/>
      </Directory>

      <!-- Desktop -->
      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>
  </Fragment>

  <!-- Components -->
  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <!-- Main executable -->
      <Component Id="GhostOverlay.exe" Guid="B2C3D4E5-F6A7-48B9-C0D1-E2F3A4B5C6D7">
        <File Id="GhostOverlay.exe"
              Source="..\publish\GhostOverlay.exe"
              KeyPath="yes"
              Checksum="yes">
          <Shortcut Id="StartMenuShortcut"
                    Directory="ApplicationProgramsFolder"
                    Name="GhostOverlay"
                    Description="Real-time Server Monitor"
                    WorkingDirectory="INSTALLFOLDER"
                    Icon="GhostOverlay.exe"
                    IconIndex="0"
                    Advertise="yes" />
        </File>
      </Component>

      <!-- PDB file (optional, for debugging) -->
      <Component Id="GhostOverlay.pdb" Guid="C3D4E5F6-A7B8-49C0-D1E2-F3A4B5C6D7E8">
        <File Id="GhostOverlay.pdb" Source="..\publish\GhostOverlay.pdb" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Start Menu Shortcut -->
    <Component Id="ApplicationShortcut" Guid="D4E5F6A7-B8C9-40D1-E2F3-A4B5C6D7E8F9" Directory="ApplicationProgramsFolder">
      <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall"/>
      <RegistryValue Root="HKCU" Key="Software\GhostOverlay" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
    </Component>

    <!-- Desktop Shortcut -->
    <Component Id="DesktopShortcut" Guid="E5F6A7B8-C9D0-41E2-F3A4-B5C6D7E8F9A0" Directory="DesktopFolder">
      <Shortcut Id="DesktopShortcut"
                Name="GhostOverlay"
                Description="Real-time Server Monitor"
                Target="[INSTALLFOLDER]GhostOverlay.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="GhostOverlay.exe"
                IconIndex="0" />
      <RemoveFolder Id="CleanUpDesktopShortcut" Directory="DesktopFolder" On="uninstall"/>
      <RegistryValue Root="HKCU" Key="Software\GhostOverlay" Name="desktopShortcut" Type="integer" Value="1" KeyPath="yes"/>
    </Component>
  </Fragment>
</Wix>
